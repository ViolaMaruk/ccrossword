<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Trener matematyki ‚Äî mno≈ºenie</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background-image: url("background.jpg");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    .container {
      background: rgba(255,255,255,0.85);
      border-radius: 15px;
      padding: 20px 40px;
      display: inline-block;
      margin-bottom: 30px;
    }
    h1, h2 { margin-bottom: 10px; }
    .task { font-size: 26px; margin: 20px; }
    input {
      width: 80px;
      font-size: 20px;
      text-align: center;
      margin: 5px;
      padding: 5px;
      border: 2px solid #aaa;
      border-radius: 5px;
      transition: all 0.3s;
    }
    input.error { background: #f8d7da; border-color: red; }
    input.correct { background: #d4edda; border-color: green; }
    .row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 10px;
    }
    .block {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .result { margin: 20px; font-size: 20px; font-weight: bold; transition: color 0.3s; }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 10px;
      border: none;
      background-color: #007bff;
      color: white;
      transition: background 0.3s;
    }
    button:hover { background-color: #0056b3; }
    .success-animate { animation: pulse 0.5s ease-in-out; }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    svg { overflow: visible; }

    /* Popup —É—Ä–æ–≤–µ–Ω—å */
    #levelUpPopup {
      display:none;
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      background: rgba(255,255,255,0.95);
      border: 2px solid #007bff;
      border-radius:15px;
      padding:30px;
      z-index:1000;
      text-align:center;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div class="container" id="main">
    <h1>üßÆ Trener mno≈ºenia</h1>

    <div class="task" id="task"></div>

    <div style="font-size:22px; font-weight:bold; margin-bottom:10px;">
      Liczba do roz≈Ço≈ºenia: <span id="mainNumber"></span>
    </div>

    <div class="row" id="tensRow">
      <div class="block" id="blockTens">
        <input id="tens" placeholder="dziesiƒÖtki">
      </div>
      <div class="block" id="blockOnes">
        <input id="ones" placeholder="jedno≈õci">
      </div>
    </div>

    <div class="row">
      <div id="operator" style="font-size:22px; font-weight:bold;"></div>
    </div>

    <div id="arrowRow" style="display:flex; justify-content:center; gap:200px; margin-bottom:10px;">
      <svg width="400" height="100">
        <defs>
          <marker id="arrow" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
            <path d="M0,0 L0,6 L9,3 z" fill="black"/>
          </marker>
        </defs>
        <line x1="100" y1="0" x2="100" y2="60" stroke="black" stroke-width="2" marker-end="url(#arrow)"/>
        <line x1="300" y1="0" x2="300" y2="60" stroke="black" stroke-width="2" marker-end="url(#arrow)"/>
      </svg>
    </div>

    <div class="row" id="partRow" style="justify-content:center; gap:10px; margin-bottom:20px;">
      <input id="part1" placeholder="..." style="width:100px; text-align:center;">
      <span style="font-size:24px; font-weight:bold;">+</span>
      <input id="part2" placeholder="..." style="width:100px; text-align:center;">
    </div>

    <div style="display:flex; justify-content:center; gap:80px; margin-bottom:10px;">
      <svg width="400" height="80">
        <defs>
          <marker id="arrow2" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
            <path d="M0,0 L0,6 L9,3 z" fill="black"/>
          </marker>
        </defs>
        <line x1="100" y1="0" x2="175" y2="50" stroke="black" stroke-width="2" marker-end="url(#arrow2)"/>
        <line x1="300" y1="0" x2="225" y2="50" stroke="black" stroke-width="2" marker-end="url(#arrow2)"/>
      </svg>
    </div>

    <div>
      <input id="final" placeholder="wynik" style="width:100px; text-align:center;">
    </div>

    <div class="result" id="result"></div>
    <button id="actionBtn">Sprawd≈∫ i dalej</button>
    <div id="stats" style="margin-top:15px; font-weight:bold; color:#333;"></div>
  </div>

  <!-- Popup —É—Ä–æ–≤–µ–Ω—å -->
  <div id="levelUpPopup">
    <p style="font-size:18px; margin-bottom:20px;">Brawo! üß† Chcesz przej≈õƒá do poziomu 50-99?</p>
    <button id="levelYes" style="margin-right:10px;">TAK</button>
    <button id="levelNo">NIE</button>
  </div>

  <script>
    class MathTrainer {
      constructor() {
        this.el = {
          tens: document.getElementById("tens"),
          ones: document.getElementById("ones"),
          part1: document.getElementById("part1"),
          part2: document.getElementById("part2"),
          final: document.getElementById("final"),
          result: document.getElementById("result"),
          task: document.getElementById("task"),
          operator: document.getElementById("operator"),
          stats: document.getElementById("stats"),
          actionBtn: document.getElementById("actionBtn"),
          main: document.getElementById("main"),
          mainNumber: document.getElementById("mainNumber"),
          popup: document.getElementById("levelUpPopup"),
          yesBtn: document.getElementById("levelYes"),
          noBtn: document.getElementById("levelNo")
        };

        this.correct = 0;
        this.total = 0;
        this.streak = 0;
        this.awaitingNext = false;
        this.startTime = null;

        this.minNumber = 10;
        this.maxNumber = 50;
        this.splitEnabled = true;

        this.el.actionBtn.addEventListener("click", () => this.handleAction());
        this.nextTask();
      }

      generateNumbers() {
        this.number = Math.floor(Math.random() * (this.maxNumber - this.minNumber + 1)) + this.minNumber;
        this.other = Math.floor(Math.random() * 9) + 1;
        this.tens = Math.floor(this.number / 10) * 10;
        this.ones = this.number % 10;
        this.correctPart1 = this.tens * this.other;
        this.correctPart2 = this.ones * this.other;
        this.correctFinal = this.correctPart1 + this.correctPart2;
      }

      nextTask() {
        this.generateNumbers();
        this.el.task.textContent = `${this.number} √ó ${this.other} = ?`;
        this.el.operator.textContent = `√ó ${this.other}`;
        this.el.mainNumber.textContent = this.number;

        document.getElementById("tensRow").style.display="flex";
        document.getElementById("partRow").style.display="flex";

        this.el.result.textContent = "";
        this.clearInputs();
        this.startTime = Date.now();
        this.el.tens.focus();
      }

      clearInputs() {
        ["tens","ones","part1","part2","final"].forEach(id => {
          const el = this.el[id];
          el.value = "";
          el.className = "";
        });
      }

      handleAction() {
        if(this.awaitingNext) {
          this.awaitingNext = false;
          this.el.actionBtn.textContent = "Sprawd≈∫ i dalej";
          this.nextTask();
        } else {
          this.check();
        }
      }

      check() {
        const {tens, ones, part1, part2, final, result, stats, main} = this.el;
        const userTens = parseInt(tens.value);
        const userOnes = parseInt(ones.value);
        const userPart1 = parseInt(part1.value);
        const userPart2 = parseInt(part2.value);
        const userFinal = parseInt(final.value);

        let errors = [];
        let ok = true;

        if(tens.value !== "" && userTens !== this.tens){ tens.className="error"; errors.push("dziesiƒÖtki"); ok=false; }
        else if(tens.value !== "") tens.className="correct";

        if(ones.value !== "" && userOnes !== this.ones){ ones.className="error"; errors.push("jedno≈õci"); ok=false; }
        else if(ones.value !== "") ones.className="correct";

        if(part1.value !== "" && userPart1 !== this.correctPart1){ part1.className="error"; errors.push("czƒô≈õƒá 1"); ok=false; }
        else if(part1.value !== "") part1.className="correct";

        if(part2.value !== "" && userPart2 !== this.correctPart2){ part2.className="error"; errors.push("czƒô≈õƒá 2"); ok=false; }
        else if(part2.value !== "") part2.className="correct";

        if(userFinal !== this.correctFinal){ final.className="error"; ok=false; errors.push("wynik ko≈Ñcowy"); }
        else final.className="correct";

        const elapsed = ((Date.now()-this.startTime)/1000).toFixed(1);

        this.total++;
        if(ok) {
          this.correct++;
          this.streak++;
          result.style.color="green";
          result.textContent=`Brawo! üéâ Poprawna odpowied≈∫: ${this.correctFinal}`;
          main.classList.add("success-animate");
          setTimeout(()=>main.classList.remove("success-animate"),600);

          if(this.streak % 5 === 0){
            this.el.popup.style.display = "block";

            this.el.yesBtn.onclick = () => {
              this.minNumber = 50;
              this.maxNumber = 99;
              this.awaitingNext = false; // —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞, —á—Ç–æ–±—ã –ø–µ—Ä–≤—ã–π –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è
              this.el.popup.style.display = "none";
              this.nextTask();
            }

            this.el.noBtn.onclick = () => {
              this.awaitingNext = false; // —Ç–æ–∂–µ —Å–±—Ä–æ—Å
              this.el.popup.style.display = "none";
              this.nextTask();
            }
          }

          if(this.streak % 10 === 0) result.textContent += " ü•á";
          if(this.streak % 20 === 0) result.textContent += " üéâ";

          this.awaitingNext=true;
          this.el.actionBtn.textContent="Nastƒôpny przyk≈Çad ‚Üí";
        } else {
          this.streak = 0;
          result.style.color="red";
          result.textContent=`B≈ÇƒÖd w: ${errors.join(", ")}. Spr√≥buj ponownie!`;
        }

        stats.textContent=`Poprawnych: ${this.correct}/${this.total} (${Math.round(this.correct/this.total*100)}%), czas: ${elapsed}s`;
      }
    }

    new MathTrainer();
  </script>
</body>
</html>
